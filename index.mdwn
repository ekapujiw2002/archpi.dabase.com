<!-- Archlinux on Raspberry PI -->

# Archlinux ARM on Raspberry PI (rpi)

<div id="tocwrapper"><!-- toc --></div>

## What's this site???

Have you had an Archlinux ARM question, typed it into Google and didn't find an answer?

Perhaps you found the answer later. Either way, do let me know at hendry AT
iki.fi and I'll add it to the [site
source](https://github.com/kaihendry/archpi.dabase.com).

## Why Archlinux ARM ?

* Cleaner
* Systemd init by default
* Easier to package and maintain

## Is there an official wiki?

Not specifically for Arm on Archlinux, though
<https://wiki.archlinux.org/index.php/Raspberry_Pi> is a good start since much
of the excellent Archlinux wiki applies to the <abbr title="Raspberry PI">rpi</abbr>.

## Installing Archlinux ARM

After installing the latest [Archlinux ARM](http://archlinuxarm.org/) from [PI downloads](http://www.raspberrypi.org/downloads) you will find you only have a 2GB root. Expand it following this [guide](http://archlinuxarm.org/forum/viewtopic.php?f=31&t=3119).

## To login

User name `root` and password `root`.

## To update

    pacman -Syu

## To search for a package

    pacman -Ss $packagename

Refer to [pacman reference](https://wiki.archlinux.org/index.php/Pacman) for more examples.

## How to ask for help

Setup your terminal to upload your console to share the output.

`curl http://archpi.dabase.com/tmux.conf > ~/.tmux.conf`

Run `tmux`. If it's not installed, installed it `pacman -S tmux`.

Now using tmux's default prefix of `ctrl+b` and the letter `p`, will upload your console to be shared.

To learn more about what tmux can do, have a look at its default key binds with `tmux lsk`.

## How to work out what your PI is doing

Run `top`.

## How to connect to your PI behind a Firewall?

See <http://pi.dabase.com/> for such a service.

## Is there an Archlinux ARM IRC channel ?

Yes, `irc://irc.freenode.net/#archlinux-arm`

## [PI Camera](http://www.raspberrypi.org/camera): Where is raspi{still,vid}?

[Rpi userland](https://github.com/raspberrypi/userland) is packaged as raspberrypi-firmware-tools.

	# pacman -Ql raspberrypi-firmware-tools | grep bin/raspi
	raspberrypi-firmware-tools /opt/vc/bin/raspistill
	raspberrypi-firmware-tools /opt/vc/bin/raspivid
	raspberrypi-firmware-tools /opt/vc/bin/raspiyuv

If you get:

	# /opt/vc/bin/raspistill -o image.jpg
	mmal: mmal_vc_component_create: failed to create component 'vc.ril.camera' (1:ENOMEM)
	mmal: mmal_component_create_core: could not create component 'vc.ril.camera' (1)
	mmal: Failed to create camera component
	mmal: main: Failed to create camera component
	mmal: Camera is not enabled in this build. Try running "sudo raspi-config" and ensure that "camera" has been enabled

You need to append to `/boot/config.txt`:

	start_file=start_x.elf
	fixup_file=fixup_x.dat

And `reboot`...

## Sending and receiving PI Camera video over the network

<a href="http://www.flickr.com/photos/hendry/9417983903/" title="2013-08-01 16.55.38 by Kai Hendry, on Flickr"><img src="http://farm8.staticflickr.com/7441/9417983903_0bd80c040c.jpg" width="500" height="375" alt="2013-08-01 16.55.38"></a>

Sending from the PI:

	/opt/vc/bin/raspivid -rot 180 -t 0 -fps 30 -b 2000000 -o - | gst-launch-1.0 -v fdsrc ! h264parse ! rtph264pay config-interval=1 pt=96 !  gdppay ! tcpserversink host=$pi_ip_address port=5000

On the machine you want to view the camera from:

	gst-launch-1.0 -v tcpclientsrc host=$pi_ip_address port=5000 ! gdpdepay ! rtph264depay ! avdec_h264 ! videoconvert ! autovideosink sync=false

## Using webp to save bandwidth

Install `cwebp` like so:

	pacman -S libwebp

	# cat capture.sh
	tmp=$(mktemp /tmp/XXX.jpg)
	webp=$(basename $tmp .jpg).webp
	raspistill -vf -o $tmp
	cwebp $tmp -o /dev/stdout
	rm -f $tmp


## How to downgrade a kernel with Archlinux Arm

	[root@pihsg ~]# cd /var/cache/pacman/pkg
	[root@pihsg pkg]# uname -a
	Linux pihsg 3.10.18-1-ARCH+ #1 PREEMPT Tue Nov 12 00:08:16 CST 2013 armv6l GNU/Linux
	root@pihsg pkg]# ls -1 | grep linux
	linux-api-headers-3.10.6-1-armv6h.pkg.tar.xz
	linux-firmware-20130610-1-any.pkg.tar.xz
	linux-firmware-20130728-1-any.pkg.tar.xz
	linux-firmware-20130917-1-any.pkg.tar.xz
	linux-firmware-20131013.7d0c7a8-1-any.pkg.tar.xz
	linux-headers-raspberrypi-3.10.18-1-armv6h.pkg.tar.xz
	linux-headers-raspberrypi-3.6.11-13-armv6h.pkg.tar.xz
	linux-headers-raspberrypi-3.6.11-14-armv6h.pkg.tar.xz
	linux-headers-raspberrypi-3.6.11-17-armv6h.pkg.tar.xz
	linux-headers-raspberrypi-3.6.11-18-armv6h.pkg.tar.xz
	linux-raspberrypi-3.10.18-1-armv6h.pkg.tar.xz
	linux-raspberrypi-3.6.11-13-armv6h.pkg.tar.xz
	linux-raspberrypi-3.6.11-14-armv6h.pkg.tar.xz
	linux-raspberrypi-3.6.11-17-armv6h.pkg.tar.xz
	linux-raspberrypi-3.6.11-18-armv6h.pkg.tar.xz
	util-linux-2.23.1-2-armv6h.pkg.tar.xz
	util-linux-2.23.2-1-armv6h.pkg.tar.xz
	util-linux-2.24-1-armv6h.pkg.tar.xz
	[root@pihsg pkg]# pacman -U linux-raspberrypi-3.6.11-18-armv6h.pkg.tar.xz
	loading packages...
	warning: downgrading package linux-raspberrypi (3.10.18-1 => 3.6.11-18)
	resolving dependencies...
	looking for inter-conflicts...

	Packages (1): linux-raspberrypi-3.6.11-18

	Total Installed Size:   21.00 MiB
	Net Upgrade Size:       -1.25 MiB

	:: Proceed with installation? [Y/n]
	(1/1) checking keys in keyring                                                    [###############################################] 100%
	(1/1) checking package integrity                                                  [###############################################] 100%
	(1/1) loading package files                                                       [###############################################] 100%
	(1/1) checking for file conflicts                                                 [###############################################] 100%
	(1/1) checking available disk space                                               [###############################################] 100%
	(1/1) downgrading linux-raspberrypi                                               [###############################################] 100%
	>>> Updating module dependencies. Please wait ...
	[root@pihsg pkg]#

